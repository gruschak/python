version: "3.5"

services:

  ws-server:
    build: ./ws_server
    restart: "no"
    ports:
      - ${WS_SERVER_PORT}:${WS_SERVER_PORT}
      - 8008:80
    volumes:
      - ./ws_server/src:/app
    environment:
      - WS_SERVER_IP_ADDR=${WS_SERVER_IP_ADDR}
      - WS_SERVER_PORT=${WS_SERVER_PORT}
    command: python ./ws_server.py

  vosk-server:
    build: ./vosk
    restart: "no"
    ports:
      - ${VOSK_SERVER_PORT}:${VOSK_SERVER_PORT}
      - 80:80
    volumes:
      - ./vosk/src:/app
    environment:
      - VOSK_SERVER_IP_ADDR=${VOSK_SERVER_IP_ADDR}
      - VOSK_SERVER_PORT=${VOSK_SERVER_PORT}
      - VOSK_MODEL_DIR=${VOSK_MODEL_DIR}
      - VOSK_SAMPLE_RATE=${VOSK_SAMPLE_RATE}
      - VOSK_ALTERNATIVES=${VOSK_ALTERNATIVES}
    command: python ./asr_server/asr_server.py

  vosk-client:
    build: ./client
    restart: "no"
    devices:
      - "/dev/snd:/dev/snd"
    volumes:
      - ./client/src:/app
    command: python ./client_mic.py vosk-server:2700
